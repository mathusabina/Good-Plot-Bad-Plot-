---
title: "Good Plot"
author: "Mathumitha Sivakumar"
date: "HS24"
output: html_document
---

# Good Plot: People killed by road accidents

## Packages

```{r}
#Install Packages 
install.packages("ggplot2") 
install.packages("tidyr")    
install.packages("dplyr")    
install.packages("ggsci")
install.packages("ggbreak")
install.packages("patchwork") 

#Loading Packages 
library(ggplot2)
library(tidyr)
library(dplyr)
library(ggsci)
library(ggbreak)
library(patchwork)
```

## Dataset

The dataset was choosen form the package "datasets". It describes road casualties in Great Britain between 1969-1984. 

```{r}

data("Seatbelts")

# Overview 
View(Seatbelts)
?Seatbelts
colnames(Seatbelts)
nrow(Seatbelts)

# The columns "drivers", "fornt" and "rear" describe the amount of people killed or seriously injured while sitting in these positions.
# The amount of rows represent the monthly data from January 1969 to December 1984. 

``` 
## Data modifikation


```{r}
#Adding a column for Month and selecting the 

deaths_all<- as.data.frame(Seatbelts)
deaths_all$Year <- rep(1969:1984, each = 12)
deaths_all$Month <- rep(1:12, times = 16)
deaths_all$Date <- as.Date(paste(deaths_all$Year, deaths_all$Month, "01", sep = "-"), format = "%Y-%m-%d")
deaths<- select(deaths_all,Date,drivers,front,rear)

```

## Change to long format

```{r}

deaths_long <- deaths %>%
  pivot_longer(cols = c(drivers,front, rear), 
               names_to = "seat_position", 
               values_to = "deaths")

```


```{r}

ggplot(deaths_long, aes(x = Date, y = deaths, fill = seat_position)) +
  geom_density(stat = "identity", alpha = 0.7, linewidth = 0.2) +  # Fix: Use `linewidth` instead of `size`
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +  # Show only years
  labs(title = "Fatalities by Seat Position: Overlapping Density Plot",
       x = "Year",
       y = "Number of Fatalities",
       fill = "Seat Position") +
    scale_fill_lancet() +   
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_line(color = "grey70", linewidth = 0.4),  # Stärkeres Hauptgitter
    panel.grid.minor = element_line(color = "grey70", linewidth = 0.3)   # Feines Nebengitter
  )

```

## Good Plot 2

Short version:

```{r}

deaths_long2 <- deaths %>%
  filter(Date >= as.Date("1976-01-01") & Date <= as.Date("1985-12-31")) %>%
  pivot_longer(cols = c(drivers,front, rear), 
               names_to = "seat_position", 
               values_to = "deaths")

```


```{r}

ggplot(deaths_long2, aes(x = Date, y = deaths, fill = seat_position)) +
  geom_density(stat = "identity", alpha = 0.7, linewidth = 0.2) +  # Fix: Use `linewidth` instead of `size`
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +  # Show only years
  labs(title = "Fatalities by Seat Position: Overlapping Density Plot",
       x = "Year",
       y = "Number of Fatalities",
       fill = "Seat Position") +
    scale_fill_lancet() +   
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_line(color = "grey70", linewidth = 0.4),  # Stärkeres Hauptgitter
    panel.grid.minor = element_line(color = "grey70", linewidth = 0.3)   # Feines Nebengitter
  )

```


# Bad Plot 


```{r}
# Create a period column for grouping
deaths_all <- deaths_all %>%
  mutate(period = ifelse(Year < 1983, "Pre-1983", "Post-1983"))

deaths_long3 <- deaths_all %>%
  select(period, drivers, front, rear) %>%
  pivot_longer(cols = c(drivers, front, rear), 
               names_to = "seat_position", 
               values_to = "deaths")

# (1) Aggregate data for the bar chart (using 'drivers' as an example)
agg_data <- deaths_all %>%
  group_by(period) %>%
  summarise(avg_deaths = mean(drivers))

# (2) Create the combined plot with three overlapping layers:
combined_plot <- ggplot() +
  # Layer 1: Aggregated Bar Chart with a truncated y-axis
  geom_bar(data = agg_data, 
           aes(x = period, y = avg_deaths, fill = period),
           stat = "identity", color = "black", alpha = 0.6) +
  # Layer 2: Boxplot for the distribution of individual driver fatalities
  geom_boxplot(data = deaths_all,
               aes(x = period, y = drivers, fill = period),
               width = 0.3, alpha = 0.4, outlier.shape = NA) +
  # Layer 3: Scatter Plot with jitter for individual data points
  geom_point(data = deaths_all, 
             aes(x = period, y = drivers, color = period),
             position = position_jitter(width = 0.2), size = 2) +
  # Labels and Title
  labs(title = "Combined Plot of Fatalities Pre- and Post-1983\n(Truncated Y-Axis & Aggregated Pre/Post Grouping)",
       x = "Period",
       y = "Fatalities") +
  # Manual color scales
  scale_fill_manual(values = c("Pre-1983" = "#e69f00", "Post-1983" = "#56B4E9")) +
  scale_color_manual(values = c("Pre-1983" = "#e69f00", "Post-1983" = "#56B4E9")) +
  # Truncate the y-axis to exaggerate differences (this is misleading)
  scale_y_break(c(30, 70)) +
  theme_minimal() +
  theme(legend.position = "none")

# Display the combined plot
combined_plot
```







